<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>PathTracer: Global Illumination | Siddharth C</title>
<meta name="keywords" content="coding, graphics, projects">
<meta name="description" content="A pathtracing course project.">
<meta name="author" content="Siddharth Chillale">
<link rel="canonical" href="https://siddharthchillale.github.io/projects/pathtracer/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4b8b7bfa5e8b459c6b8600dee1a156f41831e9846f05dbf422137ff616ddd83e.css" integrity="sha256-S4t7&#43;l6LRZxrhgDe4aFW9Bgx6YRvBdv0IhN/9hbd2D4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://siddharthchillale.github.io/profile/puzzle.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://siddharthchillale.github.io/profile/puzzle.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://siddharthchillale.github.io/profile/puzzle.png">
<link rel="apple-touch-icon" href="https://siddharthchillale.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://siddharthchillale.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://siddharthchillale.github.io/projects/pathtracer/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CMB721BXKS"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-CMB721BXKS', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="PathTracer: Global Illumination" />
<meta property="og:description" content="Portfolio" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://siddharthchillale.github.io/projects/pathtracer/" />
<meta property="og:image" content="https://siddharthchillale.github.io/projects/pathtracer/images/32_samples_doda_1.png" /><meta property="og:site_name" content="Siddharth C" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://siddharthchillale.github.io/projects/pathtracer/images/32_samples_doda_1.png" />
<meta name="twitter:title" content="PathTracer: Global Illumination"/>
<meta name="twitter:description" content="Portfolio"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Projects",
      "item": "https://siddharthchillale.github.io/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "PathTracer: Global Illumination",
      "item": "https://siddharthchillale.github.io/projects/pathtracer/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://siddharthchillale.github.io/" accesskey="h" title="Siddharth (Alt + H)">
                <img src="https://siddharthchillale.github.io/profile/puzzle.png" alt="" aria-label="logo"
                    height="35">Siddharth</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://siddharthchillale.github.io/docs/resume.pdf" title="Resume ðŸ“¥">
                    <span>Resume ðŸ“¥</span>
                </a>
            </li>
            <li>
                <a href="https://siddharthchillale.github.io/projects/" title="Projects ðŸ“‘">
                    <span>Projects ðŸ“‘</span>
                </a>
            </li>
            <li>
                <a href="https://siddharthchillale.github.io/blog/" title="Blog ðŸ§ ">
                    <span>Blog ðŸ§ </span>
                </a>
            </li>
            <li>
                <a href="https://siddharthchillale.github.io/about/" title="About ðŸ‘¤">
                    <span>About ðŸ‘¤</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://siddharthchillale.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://siddharthchillale.github.io/projects/">Projects</a></div>
  <h1>
    PathTracer: Global Illumination
  </h1>
</header>
<div class="post-content"><p><strong>Date Published:</strong> 2022-02-05 21:47:05 &#43;0530 &#43;0530</p>
<p>I develop a simple path tracer that can render scenes with global illumination. The first two
tasks focus on providing an efficient implementation of ray-scene geometry queries. In the third
task (Pathtracer) I developed the ability to simulate light bounces around the scene. Specifically,
indirect and direct illumination.
The pathtracer renders <em>COLLADA</em> files.</p>
<ul>
<li>Task 1. Generating Camera Rays</li>
<li>Task 2. Handling ray-triangle and ray-sphere intersections;</li>
<li>Task 3: Path tracing</li>
</ul>
<figure>
    <img loading="lazy" src="images/32_samples_doda_1.png"
         alt="Cornell Box with dodecahedron. 32 samples per pixel" width="600px"/> <figcaption>
            <p>Cornell Box with dodecahedron. 32 samples per pixel</p>
        </figcaption>
</figure>

<h3 id="task-1-generating-camera-rays">Task 1. Generating Camera Rays<a hidden class="anchor" aria-hidden="true" href="#task-1-generating-camera-rays">#</a></h3>
<p>Steps:</p>
<ol>
<li>By default, rays are generated from the left bottom of a pixel. Sample a random number
from 0 to 1 to add to the pixel coordinates. Normalise with respect to the screen
coordinates. Subtract 0.5 from both x and y coordinates to center the pixel.</li>
<li>Generate ray to this new normalised location with the camera position as the origin of
the ray. Calculate the sensor height and sensor width using the vertical field of view of
the camera and using trigonometry. Take care to handle units carefully as field of view
will be returned in degrees, whereas the trig functions take angles in radians.</li>
<li>Scale the normalised screen coordinates with the sensor width and sensor height
calculated from step 2.</li>
<li>The ray created is generated with respect to the camera space. This ray needs to be
converted back to world space by multiplying the ray direction with the camera to world
transformation matrix (given in camera).
Figure: Rays generated from camera.
Figure: Camera with wider aperture for shallow depth of field</li>
</ol>
<h3 id="task-2-handling-ray-triangle-and-ray-sphere-intersections">Task 2. Handling ray-triangle and ray-sphere intersections<a hidden class="anchor" aria-hidden="true" href="#task-2-handling-ray-triangle-and-ray-sphere-intersections">#</a></h3>
<p>Ray-Triangle Intersection: I used the Moller-Trumbore algorithm for Ray-triangle intersection.</p>
<p>Steps:</p>
<ol>
<li>Scotty3D function of ray-triangle intersection returns a Trace structure which contains
the information around the point where the ray hit the triangle. This contains the
information of the ray that hits that object, if the hit happens and the position where the
hit happens. It also modifies the max valid bound of the ray, so that other later hits (such
as hits that are behind the object) are ignored.</li>
<li>The above figure illustrates equations to calculate the ray-triangle intersection. Solving
the equations we get a vector of 3-dimensions. The first two coordinates (u, v) are the
barycentric coordinates w.r.t. the triangle (the beta and gamma). The last coordinate (t) is
the distance along the ray where the intersection happens.</li>
<li>Check if <code>u &gt;0 , v &gt; 0 and 1 - (u+v) &gt; 0</code> . This checks if the intersection happens inside the
triangle. Check if the t value is within the valid range of dist_bounds.min and
dist_bounds.max of the ray. If all the above conditions are true, we say the ray as hit the
triangle.</li>
<li>The position of hit is easily found by putting it in the ray equation.
Ray-Sphere intersection
Steps:</li>
<li>Similar to ray-triangle intersection we have to fill the Trace structure.</li>
<li>FRom the figure, we can say that the ray intersects the sphere if the ray satisfies the
equation of the sphere. Thus substitute the ray in sphere equation and find solutions two
ideal solution t1 and t2.</li>
<li>If the solutions are real numbers then we say that a hit has occurred. For this we can
check early by checking the signature of the determinant of the equation.</li>
<li>One thing to consider is that the equation assumes a unit sphere which is not the case in
Scotty3D. Thus, radius needs to be taken into account for solving the equation.</li>
<li>If there is a hit, update the max bound of the ray. Find the position where hit has
occurred. Fill the trace structure and return it.
Results from implementing ray-triangle and ray-sphere intersections are displayed below.
Figure: Ray-sphere intersection on Cornell Box (cbox.dae)
Ray-triangle intersection on model of Cow (cow.dae)</li>
</ol>
<figure>
    <img loading="lazy" src="images/32_samples_doda_1.png"
         alt="Cornell Box with dodecahedron. 32 samples per pixel." width="600px"/> <figcaption>
            <p>Cornell Box with dodecahedron. 32 samples per pixel.</p>
        </figcaption>
</figure>

<h3 id="task-3-path-tracing">Task 3. Path tracing<a hidden class="anchor" aria-hidden="true" href="#task-3-path-tracing">#</a></h3>
<p>Indirect illumination.</p>
<p>Steps:</p>
<ol>
<li>Randomly sample a new ray direction from the BSDF distribution using <code>BSDF::scatter()</code>.</li>
<li>Create a new world-space ray. New depth value is the previous depth-1. The bounds of
the ray are set to <code>(EPS_F, 2.0f)</code> . We also offset the origin of the ray with <code>direction * EPS_F</code>. This is done to account for numerical precision. Doing so removes a lot of white
dots that are visible in the scene otherwise.</li>
<li>Call <code>Pathtracer::trace()</code> to get incoming light. We are only interested in the second
component of this light which deals with the reflective component. Scale this by the bsdf
distribution and the cos_theta.</li>
<li>Since the sampling is done over a hemisphere, the pdf is constant at <code>(1/ 2*Pi)</code></li>
<li>Return the calculated radiance at that hit position.
Direct illumination:
Steps:</li>
<li>Repeat the same steps as indirect illumination but with 2 differences.</li>
<li>Call <code>trace()</code> to get incoming light. Since we are only interested in the emissive component
we take the first component of incoming light.</li>
<li>Now the depth value would set to 0 as we are only interested in the emissive
component.</li>
<li>Scale the radiance with cos_theta and the albedo of the material.</li>
<li>Return the radiance calculated at the hit position.
My implementation works fine for rendering triangles but has trouble rendering spheres. AS
seen in figure, even after 512 samples, spheres are not rendered in the image. Whereas,
models with triangle primitives are rendered just fine.
Plus, the current code works fine for area lights and point lights. I have included results from
using both point lights and area lights</li>
</ol>
<figure>
    <img loading="lazy" src="images/1024_samples_doda.png"
         alt="Example of 1024 samples on cornel box." width="600px"/> <figcaption>
            <p>Example of 1024 samples on cornel box.</p>
        </figcaption>
</figure>



</div>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://siddharthchillale.github.io/">Siddharth C</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
